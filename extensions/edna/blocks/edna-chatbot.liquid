{% schema %}
{
  "name": "Edna AI Assistant",
  "target": "body",
  "stylesheet": "edna-chat.css",
  "javascript": "edna-chat.js",
  "settings": [
    {
      "type": "color",
      "id": "button_color",
      "label": "Chat Button Color",
      "default": "#4A90E2"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Chat Text Color",
      "default": "#FFFFFF"
    },
    {
      "type": "text",
      "id": "chat_title",
      "label": "Chat Title",
      "default": "Edna Shopping Assistant"
    }
  ]
}
{% endschema %}

<div id="edna-chat-container" class="edna-chat-container">
  <button id="edna-chat-button" class="edna-chat-button" style="background-color: {{ block.settings.button_color }};">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
  </button>
  
  <div id="edna-chat-interface" class="edna-chat-interface">
    <div class="edna-chat-header" style="background-color: {{ block.settings.button_color }};">
      <span class="edna-chat-title" style="color: {{ block.settings.text_color }};">{{ block.settings.chat_title }}</span>
      <button class="edna-chat-close">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div class="edna-chat-messages" id="edna-chat-messages">
      <div class="edna-message edna-ai-message">
        <div class="edna-message-content">
          Hi there! I'm Edna, your personal shopping assistant. How can I help you today?
        </div>
      </div>
    </div>
    
    <div class="edna-chat-input-container">
      <textarea id="edna-chat-input" class="edna-chat-input" placeholder="Type your message here..."></textarea>
      <button id="edna-chat-send" class="edna-chat-send" style="background-color: {{ block.settings.button_color }};">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Use a hardcoded URL for testing (replace with your actual app URL)
  const apiUrl = 'https://b433-2600-4041-5874-7700-d1c3-4428-a2b4-c529.ngrok-free.app';
  console.log('Using hardcoded API URL:', apiUrl);
  initEdnaChat(apiUrl);
});
</script>